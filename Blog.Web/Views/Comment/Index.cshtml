@model List<Blog.EntityFramework.Comment>
@using Leo.Framework.Extensions
@{
    ViewData["Title"] = "留言交流 - 不落阁";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/css/comment.min.css" rel="stylesheet" asp-append-version="true" />
<div class="layui-container">
    <blockquote class="layui-elem-quote sitemap shadow">
        <i class="layui-icon">&#xe715;</i>
        <span class="layui-breadcrumb" lay-separator=">">
            <a href="/">首页</a>
            <a><cite>留言交流</cite></a>
        </span>
    </blockquote>
    <div class="layui-row layui-col-space15">
        <div class="layui-col-md8">
            <div class="layui-row layui-col-space10">
                <div class="layui-col-md12">
                    <div class="topdiv">
                        <div class="topdiv-figure">
                            <img src="~/images/messagewall.png" />
                        </div>
                        <p class="topdiv-nickname">留言板</p>
                        <p class="topdiv-introduce">可留言、可吐槽、可提问。欢迎灌水，杜绝广告！</p>
                    </div>
                </div>
                <div class="layui-col-md12">
                    <div class="comment-editor sr-bottom">
                        <form class="layui-form blog-editor">
                            <div class="layui-form-item">
                                <textarea name="content" lay-verify="content" id="remarkEditor" placeholder="请输入内容" class="layui-textarea layui-hide"></textarea>
                            </div>
                            <div class="layui-form-item">
                                <button class="layui-btn layui-btn-normal layui-btn-sm" lay-submit lay-filter="formComment">提交留言</button>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="layui-col-md12">
                    <div class="layui-row layui-col-space8 commentlist">
                        @foreach (var item in Model)
                        {
                            <div class="layui-col-md12">
                                <div class="comment-item sr-bottom">
                                    <div class="comment-item-left">
                                        <div class="useravator" title="@item.User.Name">
                                            <img src="@item.User.Avatar" alt="@item.User.Name" />
                                        </div>
                                        <div class="reply">
                                            <button class="layui-btn layui-btn-xs layui-btn-primary" blog-event="commentReply" data-id="@item.Id" data-targetid="@item.UserId" data-targetname="@item.User.Name">回复</button>
                                        </div>
                                    </div>
                                    <div class="comment-item-right">
                                        <div class="content">
                                            @Html.Raw(item.Content)
                                        </div>
                                        <p class="createtime">— 来自<span style="padding:0 3px;padding-right:10px;color:#0094ff">@item.User.Name</span>@item.CreateTime.ToStringFromNow()</p>
                                    </div>
                                    @if (item.CommentReplys.Count > 0)
                                    {
                                        <hr style="margin-right: 10px;" />
                                    }
                                    @foreach (var reply in item.CommentReplys)
                                    {
                                        <div class="comment-reply">
                                            <div class="comment-item-left">
                                                <div class="useravator" title="@reply.User.Name">
                                                    <img src="@reply.User.Avatar" alt="@reply.User.Name" />
                                                </div>
                                            </div>
                                            <div class="comment-item-right">
                                                <div class="content">
                                                    <span style="color:#01aaed;margin-right:5px;">@reply.User.Name：</span><span style="color:#ff6a00;margin-right:5px;">@@@reply.TargetUser.Name</span>@Html.Raw(reply.Content)
                                                </div>
                                                <p class="createtime">@reply.CreateTime.ToStringFromNow()<a href="javascript:;" style="margin-left:5px;color:#0094ff;vertical-align: middle;display:none;" blog-event="commentReply" data-id="@item.Id" data-targetid="@reply.UserId" data-targetname="@reply.User.Name">回复</a></p>
                                            </div>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-col-md4">
            <div class="layui-row layui-col-space10">
                <div class="layui-md-12 layui-hide-xs">
                    <div class="layui-card chatroom sr-bottom">
                        <div class="layui-card-header">聊天室<span class="status" title="离线"><i class="fa fa-circle"></i></span></div>
                        <div class="scroll">
                            <div class="layui-card-body chatroom-body">

                            </div>
                            <div id="msg_end" style="height:0px; overflow:hidden"></div>
                        </div>
                        <div class="chatroom-editor">
                            <textarea id="chateditor" style="display: none;"></textarea>
                        </div>
                        <div class="chatroom-send">
                            <button class="layui-btn layui-btn-xs layui-btn-primary" comment-event="chatsend">发送</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script id="commentTpl" type="text/html">
    {{#  layui.each(d, function(index, item){ }}
    <div class="layui-col-md12">
        <div class="comment-item sr-bottom byflow">
            <div class="comment-item-left">
                <div class="useravator" title="{{ item.user.name }}">
                    <img src="{{ item.user.avatar }}" alt="{{ item.user.name }}" />
                </div>
                <div class="reply">
                    <button class="layui-btn layui-btn-xs layui-btn-primary" blog-event="commentReply" data-id="{{ item.id }}" data-targetid="{{ item.userId }}" data-targetname="{{ item.user.name }}">回复</button>
                </div>
            </div>
            <div class="comment-item-right">
                <div class="content">
                    {{ item.content }}
                </div>
                <p class="createtime">— 来自<span style="padding:0 3px;padding-right:10px;color:#0094ff">{{ item.user.name }}</span>{{ layui.util.timeAgo(item.createTime, false) }}</p>
            </div>
            {{# if(item.commentReplys.length > 0){ }}
            <hr style="margin-right: 10px;" />
            {{#  } }}

            {{#  layui.each(item.commentReplys, function(index, reply){ }}
            <div class="comment-reply">
                <div class="comment-item-left">
                    <div class="useravator" title="{{ reply.user.name }}">
                        <img src="{{ reply.user.avatar }}" alt="{{ reply.user.name }}" />
                    </div>
                </div>
                <div class="comment-item-right">
                    <div class="content">
                        <span style="color:#01aaed;margin-right:5px;">{{ reply.user.name }}：</span><span style="color:#ff6a00;margin-right:5px;">@@{{ reply.targetUser.name }}</span>{{ reply.content }}
                    </div>
                    <p class="createtime">{{ layui.util.timeAgo(reply.createTime, false) }}<a href="javascript:;" style="margin-left:5px;color:#0094ff;vertical-align: middle;display:none;" blog-event="commentReply" data-id="{{ item.id }}" data-targetid="{{ reply.userId }}" data-targetname="{{ reply.user.name }}">回复</a></p>
                </div>
            </div>
            {{#  }); }}
        </div>
    </div>
    {{#  }); }}
</script>
<script id="statusSelHtml" type="text/html">
    <div class="status-select">
        <ul>
            <li data-status="online"><i class="fa fa-circle" style="color:#09F175;margin-right:10px;"></i>在线</li>
            <li data-status="offline"><i class="fa fa-circle" style="color:#ADADAD;margin-right:10px;"></i>离线</li>
        </ul>
    </div>
</script>
<script id="chatMsgTpl" type="text/html">
    <div class="msg {{=d.class }}">
        <div class="msg-user">
            <img src="{{=d.userAvatar }}" />
        </div>
        <div class="msg-text">
            <p class="name">{{ d.userName }}</p>
            <div class="content">
                {{ d.msg }}
            </div>
        </div>
    </div>
</script>
<environment include="Development">
    <script src="~/lib/layui/layui.js" asp-append-version="true"></script>
    <script src="~/lib/signalr/signalr.js" asp-append-version="true"></script>
    <script src="~/js/comment.js" asp-append-version="true"></script>
</environment>
<environment exclude="Development">
    <script src="~/lib/layui/layui.js" asp-append-version="true"></script>
    <script src="~/lib/signalr/signalr.min.js" asp-append-version="true"></script>
    <script src="~/js/comment.min.js" asp-append-version="true"></script>
</environment>